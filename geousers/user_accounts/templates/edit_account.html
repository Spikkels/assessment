{% extends 'base.html' %}

{% load static %}
{% load leaflet_tags %}

{% block content %}
  <h1>Edit account</h1>
  <form method="post">
    {% csrf_token %}
    <div>
      <label for="username">Username:</label>
      <input type="text" id="username" name="username" value="{{ form.instance.user.username }}">
    </div>
    <div>
      <label for="email">Email:</label>
      <input type="email" id="email" name="email" value="{{ form.instance.user.email }}">
    </div>
    <div>
      <label for="password1">New password:</label>
      <input type="password" id="password1" name="password1">
    </div>
    <div>
      <label for="password2">Confirm password:</label>
      <input type="password" id="password2" name="password2">
    </div>
    <div>
      <label for="home_address">Home address:</label>
      <input type="text" id="home_address" name="home_address" value="{{ form.instance.home_address }}">
    </div>
    <div>
      <label for="phone_number">Phone number:</label>
      <input type="text" id="phone_number" name="phone_number" value="{{ form.instance.phone_number }}">
    </div>
    <div>
      <label for="location">Location:</label>
      <input type="hidden" id="location" name="location" value="{{ form.instance.location }}">
    </div>
    <input type="submit" value="Save changes">
  </form>

  <div id="map" style="width: 100%; height: 400px;"></div>

  <script src="{% static 'leaflet/leaflet.js' %}"></script>
  <link rel="stylesheet" href="{% static 'leaflet/leaflet.css' %}">

  <script>
    var map = L.map('map').setView([{{ form.instance.location.y }}, {{ form.instance.location.x }}], 13);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    var marker = L.marker([{{ form.instance.location.y }}, {{ form.instance.location.x }}]).addTo(map);

    function onMapClick(e) {
      if (marker) {
        map.removeLayer(marker);
      }
      marker = L.marker(e.latlng).addTo(map);
      document.getElementById("location").value = "POINT(" + e.latlng.lng + " " + e.latlng.lat + ")";
    }

    map.on('click', onMapClick);
  </script>


{% endblock %}

